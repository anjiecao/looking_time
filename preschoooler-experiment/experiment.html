<!DOCTYPE html>
<html>
<head>

    <!-- jspsych -->
  <script src="js/jspsych/jspsych.js"></script>
  <script src="js/jspsych/jspsych-instructions.js"></script>
  <script src= "js/jspsych/jspsych-demog-age.js"></script>
  <script src= "js/jspsych/jspsych-demog-ethnic-US.js"></script>
  <script src= "js/jspsych/jspsych-demog-gender-and-education.js"></script>
    <script src="js/jspsych/jspsych-html-keyboard-response.js"></script>
  <script src="js/jspsych/jspsych-stimuli-presentation.js"></script>
  <script src= "js/jspsych/jspsych-survey-text.js"></script>
  <script src= "js/jspsych/jspsych-survey-likert.js"></script>
  <script src="js/jspsych/jspsych-survey-multi-choice.js"></script>
   <script src="js/jspsych/jspsych-fullscreen.js"></script>
   <script src="js/jspsych/jspsych-html-button-response.js"></script> 

    <!-- helper function -->
    <script src= "js/helper/array.js"></script>
    <script src= "js/helper/generate_blocks.js"></script>
    <script src= "js/helper/testing.js"></script>
    <script src="js/helper/generate_sticker_blocks.js"></script>
    
    <!-- task module -->
     <script src= "js/00_setting.js"></script>
     <script src= "js/00_zoom_tutorial.js"></script>
    <script src= "js/01_consent_and_demographic.js"></script>
    <script src= "js/02_task_instruction_and_practice.js"></script>
    <script src= "js/03_main_task.js"></script>
    <script src= "js/04_feedback_and_code.js"></script>
    <link rel="stylesheet" href="css/jspsych.css"></link>
</head>
<body></body>
<script>


jsPsych.data.addProperties({ subject: subject_id });

document.body.style.backgroundColor = '#B0E0E6'

window.addEventListener('keydown', function(e) {
  if(e.keyCode == 32 && e.target == document.body) {
    e.preventDefault();
  }
});



// initialize timeline
var timeline = []
var audio_files = ["sound/keypress.wav"]
var instruction_and_practice = get_instructions_and_practice()
var instruction_and_complex_blocks = instruction_and_practice.concat(main_task_complex)
var instruction_and_simple_blocks = instruction_and_practice.concat(main_task_simple)



timeline = get_zoom_tutorial(timeline) 

  
timeline.push({
  type: 'fullscreen',
  fullscreen_mode: true
  });
   





timeline = get_consent_and_demog(timeline)


  timeline.push(set_up_stimuli_version)

  var show_complex_node = {
    timeline: instruction_and_complex_blocks,
    conditional_function: function(){
        // get the data from the previous trial,
        // and check which key was pressed
        var data = jsPsych.data.get().last(1).values()[0];
        console.log(data)
        if(data.button_pressed == 0){
            return true;
        } else {
            return false;
        }
    }

}

var show_simple_node = {
    timeline: instruction_and_simple_blocks,
    conditional_function: function(){
        // get the data from the previous trial,
        // and check which key was pressed
        var data = jsPsych.data.get().last(1).values()[0];
        console.log(data)
        if(data.button_pressed == 1){
            return true;
        } else {
            return false;
        }
    }

}

timeline.push(show_complex_node)
timeline.push(show_simple_node)

  






  // timeline = timeline.concat(main_task)
  timeline.push({
  type: 'fullscreen',
  fullscreen_mode: false
});
  timeliness= get_feedback(timeline)

  
function saveData(name, data){
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '../../../cgi-bin/pokebaby/data/preschool/write_data.php');
        //xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({filename: name, filedata: data}));
    }

// For loading



jsPsych.init({
        timeline: timeline,
        show_progress_bar: false,
        preload_audio:audio_files,
        use_webaudio: true,
        //use_webaudio: true, // this won't work for local testing (CORS), but maybe on server
        preload_images: all_stimuli,
        on_trial_finish: function(){
            saveData("preschool" + subject_id, jsPsych.data.get().csv());
            //jsPsych.data.displayData();
            //setTimeout(function() { turk.submit(jsPsych.data.get().ignore('external-html').json()); }, 5000);
      }
    })

    </script>
</html>
