---
title: "01_preprocessing.rmd"
author: "anjie"
date: "9/16/2021"
output: html_document
---

```{r}
library(tidyverse)
library(here)

source(here("helper/clean_data.R"))

MERGED_DATA_PATH <- here("data/01_merged_data/merged_data.csv")
bing_d <- read_csv(here("data/bing_info.csv"))



bing_d <- bing_d %>% filter(study_name_frank == 16) %>% 
  select(bing_id, child_age_today_scheduling) %>% 
  mutate(child_age_group = case_when(
    child_age_today_scheduling > 3 & child_age_today_scheduling <= 4 ~ "3", 
    child_age_today_scheduling > 4 & child_age_today_scheduling <= 5 ~ "4",
    child_age_today_scheduling > 5 & child_age_today_scheduling <= 6 ~ "5",
  )) %>% 
  ## make sure each kid only participated once 
  distinct(bing_id, .keep_all = TRUE)



raw_df <- read_csv(MERGED_DATA_PATH) %>% 
  left_join(bing_d, by = "bing_id")

```



# preprocessed df 

```{r}

main_d <- tidy_all_rt_task_data(raw_df)
adult_d <- read_csv(here("data/adult_data.csv")) %>% mutate(child_age_group = "adult")

main_d <- main_d %>% 
  bind_rows(adult_d) %>% 
  mutate(participant_type = case_when(
    child_age_group == "adult" ~ "adult", 
    TRUE ~ "kids"
  )) %>% 
  mutate(deviant_position_print = case_when(
    deviant_position == 2 ~ "Deviant at 2nd trial", 
    deviant_position == 4 ~ "Deviant at 4th trial",
    deviant_position == 6 ~ "Deviant at 6th trial",
    TRUE ~ "No Deviant"
  ))
# missing: memory question
```

```{r}
main_d %>% 
  distinct(bing_id, child_age_group) %>% 
  group_by(child_age_group) %>% 
  count()
```

```{r}
main_d %>% 
  ggplot(aes(x = trial_number, y = log(trial_looking_time), color = trial_type)) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
  stat_summary(geom = "line", fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
   theme_classic()+
  langcog::scale_color_solarized(name = "Trial Type") + 
  theme(legend.position = "bottom") + 
  ylab("Looking Time (Log msc)")+
  xlab("Trial Number") + 
  facet_wrap(~participant_type)
```


```{r}

 main_d %>% 
  #filter(child_age_group > 3) %>% 
  ggplot(aes(x = trial_number, y = log(trial_looking_time))) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2),
               aes(color = as.factor(participant_type)
               )) + 
  stat_summary(geom = "line", fun.data = "mean_cl_boot", position = position_dodge(width = .2),
               aes(color = as.factor(participant_type))
              ) + 
  facet_wrap(~deviant_position_print)+  
  xlab("Trial Number") + 
    ylab("Looking Time (Log msc)")+

     theme_classic()+
  langcog::scale_color_solarized(name = "Trial Type") 
```


```{r}
 
 main_d %>% 
  filter(participant_type == "kids") %>% 
  ggplot(aes(x = trial_number, y = log(trial_looking_time))) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2), 
               aes(color = as.factor(child_age_group))) + 
  stat_summary(geom = "line", fun.data = "mean_cl_boot", position = position_dodge(width = .2), 
               aes(color = as.factor(child_age_group))) + 
  facet_wrap(~deviant_position_print)+  
  xlab("Trial Number") + 
  ylab("Looking Time (Log msc)")+
     theme_classic()+
  langcog::scale_color_solarized(name = "Age Group") 
 
```



