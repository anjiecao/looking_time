---
title: "02_visualization"
author: "anjie"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: yes
    theme: paper
    toc: yes
    toc_float: yes
    
---

```{r}
library(tidyverse)
library(ggthemes)
library(here)
library(lme4)

d <- read_csv(here("data/01_trimmed_data/trimmed_lt_d.csv"))

```




# background only blocks 

## everything separate

```{r}
d %>% 
  filter(block_type == "background_block") %>% 
  ggplot(aes(x = trial_number, y = log(total_rt), color = background_type)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few()  + 
  facet_wrap(~total_trial_number)
  
```

## animate vs inanimate 

```{r}
d %>% 
  filter(block_type == "background_block") %>% 
  ggplot(aes(x = trial_number, y = log(total_rt), color = animacy)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few()  + 
  facet_wrap(~total_trial_number)
```

## singleton vs pair 

```{r}
d %>% 
  filter(block_type == "background_block") %>% 
  ggplot(aes(x = trial_number, y = log(total_rt), color = number)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few()  + 
  facet_wrap(~total_trial_number)
```


## left vs right 

```{r}
d %>% 
  filter(block_type == "background_block") %>% 
  ggplot(aes(x = trial_number, y = log(total_rt), color = pose)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few()  + 
  facet_wrap(~total_trial_number)
```


# deviant 

```{r}
d %>% 
   ggplot(aes(x = trial_number, y = log(total_rt), color = trial_type)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few()  + 
  facet_grid(~violation_type)
```

## animate vs inanimate 

```{r}
d %>% 
   ggplot(aes(x = trial_number, y = log(total_rt), color = trial_type)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few()  + 
  facet_grid(animacy~violation_type)
```


## singleton vs pair 

```{r}
d %>% 
   ggplot(aes(x = trial_number, y = log(total_rt), color = trial_type)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few()  + 
  facet_grid(number~violation_type)
```

## left vs right 

```{r}

d %>% 
   ggplot(aes(x = trial_number, y = log(total_rt), color = trial_type)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few()  + 
  facet_grid(pose~violation_type)

```

# assuming background are the same 

```{r}
length(unique(d$subject))
```

```{r}

d %>% 
  mutate(half = if_else(block_number < 9, "first_half", "second_half")) %>% 
  mutate(violation_type_with_background = case_when(
    trial_type == "background" ~ "background", 
    TRUE ~ violation_type
  )) %>% 
   ggplot(aes(x = trial_number, y = total_rt, color = violation_type_with_background)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few() +
  scale_y_log10() + 
  facet_wrap(~half)
```


```{r}

d %>% 
  mutate(half = if_else(block_number < 9, "first_half", "second_half")) %>% 
  mutate(violation_type_with_background = case_when(
    trial_type == "background" ~ "background", 
    TRUE ~ violation_type
  )) %>% 
   ggplot(aes(x = trial_number, y = total_rt, color = violation_type_with_background)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few() +
  ylab("Reaction Time (ms)") + 
  xlab("Trial Number") + 
  scale_color_discrete(name = "Trial Type") + 
  scale_y_log10() 

#+ 
  #facet_wrap(~half)

```
```{r}
d %>% 
  mutate(violation_type_with_background = case_when(
    trial_type == "background" ~ "background", 
    TRUE ~ violation_type
  )) %>% 
  filter(trial_type != "background") |>
   ggplot(aes(x = violation_type, y = total_rt, color = violation_type_with_background)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few() +
  scale_y_log10()#+ 
  #facet_wrap(~half)
```

## asymmetry? 

```{r}
d %>% filter(
  violation_type_with_background %in% c("background", "animacy")
) %>% 
  mutate(
    background_animacy = case_when(
      grepl("inanimate", background_stimulus) ~ "background: inanimate",
      TRUE ~ "background: animate"
    ), 
    deviant_animacy = case_when(
      grepl("inanimate", deviant_stimulus) ~ "deviant: inanimate", 
      deviant_stimulus == "null" ~ "deviant:na", 
      TRUE ~ "deviant: animate"
    )
  ) %>% 
   ggplot(aes(x = trial_number, y = total_rt, color = violation_type_with_background)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few() +
  ylab("Reaction Time (ms)") + 
  xlab("Trial Number") + 
  scale_color_discrete(name = "Trial Type") + 
  scale_y_log10()  + 
  facet_wrap(~background_animacy)

```



```{r}
d %>% 
  mutate(violation_type_with_background = case_when(
    trial_type == "background" ~ "background", 
    TRUE ~ violation_type
  )) %>% 
  filter(trial_type != "background") |>
   ggplot(aes(x = total_rt, fill = violation_type_with_background)) + 
  geom_histogram(bins = 10) + 
  facet_wrap(~violation_type) + 
  theme_few() +
  scale_x_log10()
  #facet_wrap(~half)

```

```{r}
d %>% 
  mutate(half = if_else(block_number < 9, "first_half", "second_half")) %>% 
  mutate(violation_type_with_background = case_when(
    trial_type == "background" ~ "background", 
    TRUE ~ violation_type
  )) %>% 
   ggplot(aes(x = trial_number, y = log(total_rt), color = violation_type_with_background)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  facet_grid(half~total_trial_number)+ 
  theme_few()
```

# super bad precision analysis

```{r}
p1 <- d %>% 
  mutate(violation_type_with_background = case_when(
    trial_type == "background" ~ "background", 
    TRUE ~ violation_type
  )) %>% 
  filter(trial_type != "background") |>
   ggplot(aes(x = violation_type, y = total_rt, color = violation_type_with_background)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few() +
  scale_color_discrete(guide = "none") + 
  scale_y_log10()

p2 <- bind_rows(d, 
          d |> mutate(subject = str_c(subject, "-2")), 
          d |> mutate(subject = str_c(subject, "-3")), 
          d |> mutate(subject = str_c(subject, "-4")),
          d |> mutate(subject = str_c(subject, "-5")),
          d |> mutate(subject = str_c(subject, "-6")),
          d |> mutate(subject = str_c(subject, "-7")),
          d |> mutate(subject = str_c(subject, "-8"))) %>% 
  mutate(violation_type_with_background = case_when(
    trial_type == "background" ~ "background", 
    TRUE ~ violation_type
  )) %>% 
  filter(trial_type != "background") |>
   ggplot(aes(x = violation_type, y = total_rt, color = violation_type_with_background)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  theme_few() +
  scale_color_discrete(guide = "none") +
  scale_y_log10()

cowplot::plot_grid(p1, p2)
```

# embedding relationships? 


log(looking time) ~ I((exp(1)**(-trial_number))) + I((exp(1)**(-trial_number))) * item_number + I((exp(1)**(-trial_number))) * item_orientation + I((exp(1)**(-trial_number))) * item_category + I((exp(1)**(-trial_number))) * trial_type + (trial_number * item_number | subject) + (trial_number * item_orientation | subject) + (trial_number * item_category | subject) + (trial_number * trial_type | subject)

## first run the model 

```{r}
d <- d %>% mutate(violation_type_with_background = case_when(
    trial_type == "background" ~ "background", 
    TRUE ~ violation_type
  )) 
```


```{r}

# very time intensive, didn't work? 

# m0 <- lmer(
#   log(total_rt) ~ I((exp(1) ** (-trial_number))) +
#                 I((exp(1)**(-trial_number))) * number +
#               I((exp(1)**(-trial_number)))  * pose +
#               I((exp(1)**(-trial_number)))  * animacy +
#               I((exp(1)**(-trial_number))) * violation_type_with_background +
#               (trial_number * number | subject) + (trial_number * pose | subject) + (trial_number * animacy | subject) + (trial_number * violation_type_with_background | subject),
#   data = d
# 
# )

# failed to converge
# m1 <- lmer(
#   log(total_rt) ~ I((exp(1) ** (-trial_number))) +
#                 I((exp(1)**(-trial_number))) * number +
#               I((exp(1)**(-trial_number)))  * pose +
#               I((exp(1)**(-trial_number)))  * animacy +
#               I((exp(1)**(-trial_number))) * violation_type_with_background +
#               (number | subject) + (pose | subject) + (animacy | subject) + (violation_type_with_background | subject),
#   data = d
# 
# )

# # failed to converge
# m2 <- lmer(
#   log(total_rt) ~ I((exp(1) ** (-trial_number))) +
#                 I((exp(1)**(-trial_number))) * number +
#               I((exp(1)**(-trial_number)))  * pose +
#               I((exp(1)**(-trial_number)))  * animacy +
#               I((exp(1)**(-trial_number))) * violation_type_with_background +
#              (violation_type_with_background | subject),
#   data = d
# 
# )

m3 <- lmerTest::lmer(
  log(total_rt) ~ I((exp(1) ** (-trial_number))) +
                I((exp(1)**(-trial_number))) * number +
              I((exp(1)**(-trial_number)))  * pose +
              I((exp(1)**(-trial_number)))  * animacy +
              I((exp(1)**(-trial_number))) * violation_type_with_background +
             (1 | subject),
  data = d

)



```

# get residual 

```{r}
d$residual = resid(m3)
```

```{r}
resid_d %>% 
  ggplot(aes(x = val, y = residual, color = violation_type_with_background)) + 
  geom_point(alpha = .3) +
  geom_smooth(method = "lm") + 
  theme_few()
```


```{r}
resid_d <- d %>% 
  filter(violation_type_with_background != "background")


summary(lm(residual ~ violation_type_with_background * val, 
   data = resid_d))
```



