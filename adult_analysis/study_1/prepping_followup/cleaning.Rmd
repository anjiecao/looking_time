---
title: "prepping followup"
author: "anjie & gal"
date: "4/14/2022"
output: html_document
---

```{r}
library(tidyverse)
library(here)
library(jsonlite)
```

# get the subject id prolific id pariing 
```{r}
# has pairing 
rt_d <- read_csv(here("data/02_processed_data/processed_rt_task_data.csv"))
# has prolific id
p_id <- read_csv(here("data/01_merged_data/merged_data.csv")) %>% 
  filter(trial_type == "survey-text" & grepl("p_id", responses)) %>% 
  select(subject, responses) %>% 
  mutate(prolific_id = map(responses, ~ fromJSON(.) %>% as.data.frame()) %>% unlist()) %>% 
  filter(subject %in% unique(rt_d %>% pull(subject))) %>% 
  select(subject, prolific_id)

#raw dataset tells us the stimuli used in memory and curiosity ratings 
raw_d <- read_csv(here("data/01_merged_data/merged_data.csv"))

  
```


# figure out what stimuli participnats have seen

```{r}
# easiest case for math condition participants
background <- rt_d %>% 
  distinct(subject, trial_type, stimulus_displayed) %>% 
  ungroup() %>% 
  filter(trial_type == "background") %>% 
  group_by(subject, trial_type) %>% 
  summarise(background_stimuli = list(stimulus_displayed))

deviant <- rt_d %>% 
  distinct(subject, trial_type, stimulus_displayed) %>% 
  ungroup() %>% 
  filter(trial_type == "deviant") %>% 
  group_by(subject, trial_type) %>% 
  summarise(deviant_stimuli = list(stimulus_displayed))

json_df <- background %>% 
  left_join(deviant, by = "subject") %>% 
  select(subject, background_stimuli, deviant_stimuli)

# figure out the question stimuli
question_stimuli_set <- raw_d %>% 
  filter(subject %in% unique(rt_d$subject)) %>% 
  filter(stimulus_type == "curiousity" | stimulus_type == "memory_test") %>% 
  select(subject, block_index, question_stimuli) %>% 
   group_by(subject) %>% 
  summarise(question_stimuli = list(question_stimuli))

json_df <- json_df %>% left_join(question_stimuli_set, by = "subject")

subject_stimuli_json <- jsonlite::toJSON(json_df, pretty=T)


write(subject_stimuli_json, here("prepping_followup/subject_stimuli_json.json"))
```

`





