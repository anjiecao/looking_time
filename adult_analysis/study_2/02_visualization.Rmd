---
title: "02_visualization"
author: "anjie"
date: "9/6/2021"
output:
  html_document:
    code_folding: "hide"
---

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
library(jsonlite)
library(kableExtra)

RAW_DATA_PATH <- here("data/01_merged_data/merged_data.csv")
MAIN_TASK_PATH <- here("data/02_processed_data/processed_rt_task_data.csv")


raw_data <- read_csv(RAW_DATA_PATH)
d <- read_csv(MAIN_TASK_PATH)
```

# Basic info 


## post-exclusion 

```{r}
d %>% 
  distinct(subject, task_type) %>% 
  count(task_type) %>% 
   kableExtra::kable()
```



# Check raw looking time distribution {.tabset}

bad (?): the irregular shapes 

## by block type and trial type 

```{r}
d %>% 
  filter(!trial_number == 1) %>% 
  ggplot(aes(x = trial_looking_time, fill = task_type)) + 
  scale_x_log10() + 
  geom_density(alpha = .5) + 
  facet_grid(trial_type~block_type)
```

## by position of deviant and trial_type

```{r}
d %>% 
    filter(!trial_number == 1) %>% 
  ggplot(aes(x = trial_looking_time, fill = task_type)) + 
  scale_x_log10() + 
  geom_density(alpha = .5) + 
  facet_grid(trial_type~deviant_position)
```

## by block_number and trial_type 

weirder shapes toward the latter part of the experiment 

```{r}
d %>% 
  filter(!trial_number == 1) %>% 
  ggplot(aes(x = trial_looking_time, fill = task_type)) + 
  scale_x_log10() + 
  geom_density(alpha = .5) + 
  facet_grid(trial_type~block_number)
```

# Look at within block dynamics {.tabset}

## exposure type 


```{r}
d %>% 
  filter(trial_number %in% c(1, 2)) %>% 
  group_by(trial_type, forced_exposure_time, trial_number) %>% 
  summarise(n = n())
```


see evidence for complexity effect, not too much effect on the habituation? 
no evidence for familairity preference 
weak effect of exposure length 

```{r}
d %>% 
  filter(trial_number == 2) %>% 
  ggplot(aes(x = as.factor(forced_exposure_time), 
             y = log(trial_looking_time),
             colour= as.factor(trial_type), 
             shape = as.factor(block_type))) + 
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  geom_hline(yintercept = log(500), color = "gray") + 
  geom_hline(yintercept = log(10000), color = "gray") + 
  #langcog::theme_mikabr() +
  theme_classic()+
  langcog::scale_color_solarized(name = "Trial Type") + 
  theme(legend.position = "bottom") + 
  ylab("log RT (seconds) at the second trial") + 
  xlab("Exposure time at the first trial") + 
  labs(title = "exposure effect on the second trial")
```

```{r}
d %>% 
  mutate(
    deviant_position_print = case_when(
      deviant_position == 2 ~ "second trial deviant", 
      deviant_position == 4 ~ "fourth trial deviant", 
      deviant_position == 6 ~ "sixth trial deviant", 
      is.na(deviant_position) ~ "no deviant trial"
    )
  ) %>% 
  ggplot(aes(x = trial_number, 
             y = log(trial_looking_time),
             colour= as.factor(forced_exposure_time))) + 
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
    stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  facet_wrap(~deviant_position_print) + 
  #langcog::theme_mikabr() +
  theme_classic()+
  langcog::scale_color_solarized(name = "Trial Type") + 
  theme(legend.position = "bottom") + 
  ylab("log RT (seconds)") + 
  xlab("Trial number") + 
  labs(title = "By sequence type")
```



## complexity effect 

tbh a little difficult to see 

```{r}
d %>% 
  filter(trial_number != 1) %>% 
  ggplot(aes(x=trial_number, y=log(trial_looking_time), colour=trial_type)) + 
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
  geom_smooth(method = "lm", 
              formula = y ~ I(exp(1)**(-x)), se = FALSE) + 
  facet_wrap(~block_type) +
  #langcog::theme_mikabr() +
  theme_classic()+
  langcog::scale_color_solarized(name = "Trial Type") + 
  theme(legend.position = "bottom") + 
  ylab("log RT (seconds)") + 
  xlab("Trial Number")
```

## complexity interact with the exposure tyep?  

not the best representation since it ignores the sequence effect 

```{r}
d %>% 
  ggplot(aes(x=trial_number, y=log(trial_looking_time), colour=block_type)) + 
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
  stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2)) + 
  facet_grid(forced_exposure_time~trial_type) +
  #langcog::theme_mikabr() +
  theme_classic()+
  langcog::scale_color_solarized(name = "Trial Type") + 
  theme(legend.position = "bottom") + 
  ylab("log RT (seconds)") + 
  xlab("Trial Number")
```

## look at sequence schema 

```{r}
d %>% 
  mutate(sequence_scheme = case_when(
    deviant_position == 2 ~ "BDBBBB", 
    deviant_position == 4 ~ "BBBDBB", 
    deviant_position == 6 ~ "BBBBBD", 
    is.na(deviant_position) ~ "BBBBBB"
  )) %>% 
  #filter(trial_type == "background") %>% 
  ggplot(aes(x=trial_number, y=log(trial_looking_time), color = block_type)) + 
   stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
   stat_summary(fun.data = "mean_cl_boot", geom = "line", position = position_dodge(width = .2))+
  #geom_smooth(method = "lm", 
  #            formula = y ~ I(exp(1)**(-x)), se = FALSE) + 
  facet_wrap(~sequence_scheme) +
  #langcog::theme_mikabr() +
  theme_classic()+
  langcog::scale_color_solarized(name = "Trial Type") + 
  theme(legend.position = "bottom") + 
  ylab("log RT (seconds)") + 
  xlab("Trial Number")
```




# Look at across blocks dynamics {.tabset}

across block habituation effect is present but less salient 

## overall 

```{r}
d %>% 
  ggplot(aes(x=block_number, y=log(trial_looking_time), colour=block_type)) + 
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .2)) + 
  geom_smooth() + 
  #langcog::theme_mikabr() +
  theme_classic()+
  langcog::scale_color_solarized(name = "Trial Type") + 
  theme(legend.position = "bottom") + 
  ylab("log RT (seconds)") + 
  xlab("Trial Number")
```

# Compare with pure self-paced


# running planned analysis 
